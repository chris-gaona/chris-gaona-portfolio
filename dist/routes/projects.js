"use strict";var express=require("express");var router=express.Router();var mongoose=require("mongoose");var Project=mongoose.model("Project");var jwt=require("express-jwt");var auth=jwt({secret:"SECRET",userProperty:"payload"});router.param("id",function(e,r,s,o){var t=Project.findById(o);t.exec(function(r,o){if(r){return s(r)}if(!o){return s(new Error("can't find project"))}e.project=o;return s()})});router.get("/projects",function(e,r,s){Project.find(function(e,o){if(e){return s(e)}r.json(o)})});router.get("/project/:id",function(e,r,s){r.json(e.project)});router.post("/new",auth,function(e,r,s){var o=new Project(e.body);o.save(function(e,o){if(e){if(e.name==="ValidationError"){var t=[];if(e.errors.name){t.push({code:400,message:e.errors.name.message})}if(e.errors.category){t.push({code:400,message:e.errors.category.message})}if(e.errors.image){t.push({code:400,message:e.errors.image.message})}if(e.errors.created_on){t.push({code:400,message:e.errors.created_on.message})}if(e.errors.github_link){t.push({code:400,message:e.errors.github_link.message})}var a={message:"Validation Failed",errors:{property:t}};return r.status(400).json(a)}else{return s(e)}}r.json(o)})});router.put("/edit/:id",auth,function(e,r,s){e.project.update(e.body,{runValidators:true},function(e,o){if(e){if(e.name==="ValidationError"){var t=[];if(e.errors.name){t.push({code:400,message:e.errors.name.message})}if(e.errors.category){t.push({code:400,message:e.errors.category.message})}if(e.errors.image){t.push({code:400,message:e.errors.image.message})}if(e.errors.created_on){t.push({code:400,message:e.errors.created_on.message})}if(e.errors.github_link){t.push({code:400,message:e.errors.github_link.message})}var a={message:"Validation Failed",errors:{property:t}};return r.status(400).json(a)}else{return s(e)}}r.json({project:o,message:"Project Updated"})})});module.exports=router;